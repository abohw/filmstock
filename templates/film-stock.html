{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}{{ film.brand }} {{ film.name }} ({{ film.format }}){% endblock %}

{% block content %}

    {% load query_parameters %}
    {% del_query_parameters page as=clean_filters %}

    {% include 'filmstock-intro.html' %}

        <div class="row justify-content-around">

            <div class="col-md-6" style="margin-top:10px;">

        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/film/" class="link">Film</a></li>
            <li class="breadcrumb-item active" aria-current="page">{{ film.brand }} {{ film.name }} ({{ film.format }})</li>
          </ol>
        </nav>


       {% if user.is_authenticated %}
        {% if film.follows.hunter == user %}
        <a href="#" class="btn btn-primary disabled" tabindex="-1" role="button">
            Tracking
        </a>
        {% else %}
        <a href="/film/track/{{ film.id }}" class="btn btn-primary" tabindex="-1" role="button">
            Track
        </a>
        {% endif %}
    {% else %}
    <a href="{% url 'signup' %}?from=savesearch" class="btn btn-primary" tabindex="-1" role="button">
        Track
    </a>
    {% endif %}

        <div class="table-responsive" style="margin-top:25px;">

        <table class="table">

          <thead>
            <th scope="col" width="60%">Source</th>
            <th scope="col">Quantity</th>
            <th scope="col">Price</th>
            <th scope="col"></th>
          </thead>

          <tbody>

          {% for stock in stocks %}

            <tr>
              <td class="align-middle">
                {{ stock.source }}
                <br><small>
                  ({% if stock.shipping == 0.00 %}Free
                  {% else %}${{ stock.shipping|floatformat:2 }}
                  {% endif %}delivery)</small>
              </td>
              <td class="align-middle">{{ stock.quantity }}</td>
              <td class="align-middle">${{ stock.price|floatformat:2 }}
                  {% if stock.quantity != 1 %}<br><small>(${{ stock.per_unit|floatformat:2 }} per roll)</small>{% endif %}</td>
              <td class="align-middle text-end">
                <a href="{{ stock.url }}" target="_blank" class="btn btn-primary" tabindex="-1" role="button">
                    Buy
                </a>
              </td>
            </tr>

          {% endfor %}

          </tbody>
        </table>

        </div>

        <p></p>

        <nav>
          <ul class="pagination pagination-sm flex-wrap justify-content-start">
            {% if page_obj.has_previous %}
            <li class="page-item">
              <a class="page-link" href="?{% if clean_filters %}{{ clean_filters }}&{% endif %}page={{ page_obj.previous_page_number }}" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
              </a>
            </li>
            {% else %}
            <li class="page-item disabled">
              <a class="page-link" href="#" tabindex="-1" aria-disabled="true" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
              </a>
            </li>
            {% endif %}
            {% for page in page_obj.paginator.page_range %}
              {% if page == page_obj.number %}
              <li class="page-item active" aria-current="page">
                <span class="page-link">{{ page }}</span>
              </li>
              {% else %}
              <li class="page-item"><a class="page-link" href="?{% if clean_filters %}{{ clean_filters }}&{% endif %}page={{ page }}">
               {{ page }}</a></li>
              {% endif %}
            {% endfor %}
            {% if page_obj.has_next %}
            <li class="page-item">
              <a class="page-link" href="?{% if clean_filters %}{{ clean_filters }}&{% endif %}page={{ page_obj.next_page_number }}" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
              </a>
            </li>
            {% else %}
            <li class="page-item disabled">
              <a class="page-link" href="#" tabindex="-1" aria-disabled="true" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
              </a>
            </li>
            {% endif %}
          </ul>
        </nav>


    </div>
    </div>

{% endblock %}
